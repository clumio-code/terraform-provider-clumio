---
page_title: "Getting Started with the Provider and Protect"
---

# Getting Started with the Provider and Protect
- [Prerequisites](#prerequisites)
- [Sample configuration](#sample-configuration)
- [Clumio AWS connections](#clumio-aws-connections)
    - [Basic Clumio AWS connection](#basic-connection)
    - [Cross-region AWS connections](#cross-region)
    - [Cross-account AWS connections](#cross-account)
- [Import resources](#import)
- [Link the Clumio Provider to an OU](#ou)

<a name="prerequisites"></a>
## Prerequisites
### Obtain a Clumio API Key:
API Token (personal or service token) can be generated from Settings->Access Management->API Tokens on the Clumio portal.
### Prepare your environment
- These credentials will be used by the AWS Terraform provider to provision resources required by Clumio in the target AWS account (see Example 1 or Example 2 below). If resources must be created in a cross-AWS-account, these credentials will need the ability to assume a role there (see Example 3 below).
- NOTE: For Example 4 and Example 5 credentials are provided in a different manner to the AWS Terraform provider and thus this step should not be required.
```shell
$ export AWS_ACCESS_KEY_ID=<AWS_ACCESS_KEY_ID>
$ export AWS_SECRET_ACCESS_KEY=<AWS_SECRET_ACCESS_KEY>

# If a session token is required ...
$ export AWS_SESSION_TOKEN=<AWS_SESSION_TOKEN>
```
### Connect to Clumio
- NOTE: In all examples, replace <clumio_api_token> and <clumio_api_base_url> with the appropriate values. The clumio_api_token should be set to the token obtained in the first step. <clumio_api_base_url>  should be one of the following depending on the Clumio portal in-use:
    - https://us-west-2.api.clumio.com
        - portal: https://west.portal.clumio.com/
    - https://us-east-1.api.clumio.com
        - portal: https://east.portal.clumio.com/
    - https://ca-central-1.ca.api.clumio.com
        - portal: https://canada.portal.clumio.com/

### Set up data group if required
- When a new organization is being used, a data group needs to be created from the Clumio UI before clumio_organizational_unit resource could be used.
    - DataGroup can be created from Settings->Organizational Units->Set up data groups

<a name="sample-configuration"></a>
## Sample configuration
This sample Terraform configuration highlights several resources in the Clumio Terraform Provider.
- Downloads and instantiates the Clumio Provider and AWS Provider.
- Creates a connection with AWS (clumio_aws_connection) and installs the Clumio module for Protect onto it.
- Creates custom Clumio resources, including:
    - clumio_policy
    - clumio_policy_rule
    - clumio_organizational_unit
    - clumio_user
    - clumio_protection_group
    - clumio_policy_assignment

{{ tffile "examples/guides/complete_config.tf" }}
<a name="clumio-aws-connections"></a>
## Clumio AWS connections
The clumio_aws_connection resource connects AWS accounts to Clumio. Once the connection is created, the resources in the Clumio AWS template module need to be installed in the connected AWS account. These resources in the module allow Clumio to read the required information from the connected AWS account.

The Clumio API token and the AWS credentials are required.

<a name="basic-connection"></a>
### Basic Clumio AWS connection
The following:
- Instantiates the Clumio Provider and AWS Provider.
- Connects an AWS account to Clumio and invokes the module to create the resources in the connected AWS account.
{{ tffile "examples/guides/basic_connection.tf" }}

<a name="cross-region"></a>
### Cross-region AWS Connections
- Instantiates the Clumio Provider.
- Instantiates two AWS Providers where the attributes for each denote two different AWS regions.
- Creates two instances of clumio_aws_connection and installs the Clumio module for Protect onto both.
{{ tffile "examples/guides/cross_region.tf" }}

<a name="cross-account"></a>
## Cross-account AWS Connections
This scenario requires a Clumio API token and AWS credentials to provision resources. If resources must be created in a cross-AWS-account, the AWS credentials must have permission to assume a role there.

The following:
- Instantiates the Clumio Provider.
- Instantiates two AWS Providers where the attributes for each denote the cross-account role to assume on two different AWS accounts.
- Creates two instances of connection with AWS (clumio_aws_connection) and installs the Clumio module for Protect onto both.
- NOTE: Replace \<assume_role_arn_1\>, \<assume_role_external_id_1\>, \<assume_role_arn_2\>, and \<assume_role_external_id_2\> with the appropriate values to assume a cross-account role on the two different AWS accounts.
{{ tffile "examples/guides/cross_account.tf" }}

<a name="import"></a>
## Import resources
The Clumio Terraform Provider can import resources created through the Clumio UI or REST API to be managed using Terraform.
1. Specify an empty custom resource in the Terraform file for the Clumio resource to be imported:
{{ tffile "examples/guides/import.tf" }}
2. Run the Terraform import command, where clumio_policy_id is the Clumio policy ID you want to import.
```shell
$ terraform import clumio_policy.policy <clumio_policy_id>
```
3. Populate the Terraform file with the details of the imported resource. Find imported resource details using the terraform state show command:
```shell
$ terraform state show clumio_policy.policy

# clumio_policy.policy:
resource "clumio_policy" "policy" {
    activation_status      = "activated"
    id                     = "a44a4d91-c50c-4a61-bd4d-c46cf1c4427a"
    lock_status            = "unlocked"
    name                   = "demo"
    organizational_unit_id = "00000000-0000-0000-0000-000000000000"

    operations {
        action_setting = "immediate"
        type           = "aws_ebs_volume_backup"

        slas {
            retention_duration {
                unit  = "days"
                value = 14
            }

            rpo_frequency {
                unit  = "days"
                value = 1
            }
        }
        slas {
            retention_duration {
                unit  = "days"
                value = 7
            }

            rpo_frequency {
                unit  = "on_demand"
                value = 0
            }
        }
    }
}
```

<a name="ou"></a>
## Link the Clumio Provider to an OU
You can instantiate the Clumio Terraform provider with an existing organizational unit (OU), where <clumio_ou_id> is replaced with the ID of an OU.
{{ tffile "examples/guides/link_provider_to_ou.tf" }}
